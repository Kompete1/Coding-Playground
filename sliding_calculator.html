<!DOCTYPE html>
<html lang="en-ZA">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home Loan (Bond) Sliding Calculator — Starter</title>
    <meta
      name="description"
      content="Single‑file demo of a slider‑driven home‑loan repayment calculator for South Africa (ZAR)."
    />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="stylesheet" href="styles.css" />
    <script defer src="main.js"></script>
    <!-- Chart.js for the small doughnut chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
    :root {
      /* Palette aligned to Coding‑Playground look (clean light UI + blue accent). Adjust here to match site exactly. */
      --bg: #ffffff;
      --surface: #f5f7fb; /* subtle panel */
      --text: #0f172a;    /* slate‑900 */
      --muted: #475569;   /* slate‑600 */
      --line: #e5e7eb;    /* gray‑200 */
      --primary: #2563eb; /* blue‑600 */
      --primary-700: #1d4ed8;
      --ring: #93c5fd;    /* blue‑300 */
      --ok: #10b981;      /* emerald‑500 */
      --warn: #f59e0b;    /* amber‑500 */
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg:#0b1220; --surface:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --line:#1f2937; --ring:#3b82f6; }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; color: var(--text); background: var(--bg); }

    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }

    .calc-header { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding-block: 8px 16px; border-bottom: 1px solid var(--line); }
    .calc-header h1 { font-size: clamp(1.25rem, 2.2vw, 1.75rem); margin: 0; letter-spacing: 0.1px; }
    .calc-header .badge { font: 600 12px/1 ui-sans-serif, system-ui; color: var(--primary); background: color-mix(in oklab, var(--primary) 12%, transparent); padding: 6px 10px; border-radius: 999px; border: 1px solid color-mix(in oklab, var(--primary) 25%, transparent); }

    .calc-layout { display: grid; grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr); gap: 24px; padding-block: 20px; }
    @media (max-width: 920px) { .calc-layout { grid-template-columns: 1fr; } }

    .panel { background: var(--surface); border: 1px solid var(--line); border-radius: 16px; padding: 18px; box-shadow: 0 1px 0 rgba(0,0,0,.02), 0 .5px 0 rgba(0,0,0,.03) inset; }
    .panel h2 { margin: 0 0 12px; font-size: 1.1rem; }

    /* Inputs grid */
    .inputs { display: grid; grid-template-columns: 1fr; gap: 16px; }
    .field { display: grid; grid-template-columns: 1fr minmax(140px, 200px); align-items: center; gap: 14px; }
    @media (max-width:720px){ .field { grid-template-columns: 1fr; } }

    .field-label { display: block; font-weight: 600; margin-bottom: 8px; }

    input[type="range"] { appearance: none; width: 100%; height: 6px; border-radius: 999px; background: linear-gradient(90deg, var(--primary) var(--_pct,0%), #cbd5e1 0); outline: none; }
    input[type="range"]::-webkit-slider-thumb { appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #fff; border: 2px solid var(--primary); box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 35%, transparent); cursor: pointer; }
    input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; border: 2px solid var(--primary); border-radius: 50%; background: #fff; box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 35%, transparent); cursor: pointer; }

    .number { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--line); background: #fff; font: inherit; text-align: right; font-variant-numeric: tabular-nums; }
    .number:focus { outline: none; box-shadow: 0 0 0 3px var(--ring); }

    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 8px; }
    .btn { border: 1px solid var(--line); background: #fff; padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    .btn.primary { color: #fff; background: var(--primary); border-color: var(--primary-700); }
    .btn:focus-visible { outline: none; box-shadow: 0 0 0 3px var(--ring); }

    .results { display: grid; gap: 18px; }
    .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; align-items: stretch; }
    .result-card { background: #fff; border: 1px solid var(--line); border-radius: 14px; padding: 16px; min-width: 0; display: flex; flex-direction: column; gap: 8px; }
    .result-card.featured { grid-column: 1 / -1; }
    .chart-card { justify-content: center; }
    .chart-card canvas { width: 100% !important; height: auto !important; max-height: 220px; }
    .result-card h3 { margin: 0 0 8px; font-size: 0.95rem; color: var(--muted); }
    .big { font-size: clamp(1.6rem, 3.4vw, 2.2rem); font-weight: 800; letter-spacing: -0.02em; font-variant-numeric: tabular-nums; }
    .muted { color: var(--muted); font-size: 0.9rem; }
    .foot { margin-top: 4px; font-size: 0.85rem; color: var(--muted); }
  </style>
  </head>
  <body id="top">
    <a class="skip-link" href="#main-content">Skip to content</a>
    <header class="site-header" role="banner">
      <nav class="site-nav" aria-label="Primary navigation">
        <a class="brand" href="index.html" aria-label="Site home">Brand</a>
        <button class="menu-toggle" type="button" aria-expanded="false" aria-controls="primary-menu">
          <span class="menu-label">Menu</span>
          <span class="menu-icon" aria-hidden="true"></span>
        </button>
        <button class="theme-toggle" type="button" aria-pressed="false" aria-label="Toggle color theme">
          <span class="theme-toggle__icon" aria-hidden="true"></span>
          <span class="theme-toggle__label">Theme</span>
        </button>
        <span id="clock" aria-live="polite"></span>
        <ul id="primary-menu" class="nav-links" aria-hidden="true">
          <li><a href="index.html">Home</a></li>
          <li><a href="index.html#features">Features</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="sliding_calculator.html" aria-current="page">Sliding Calculator</a></li>
        </ul>
      </nav>
    </header>

    <main id="main-content">
      <div class="wrap">
        <header class="calc-header">
          <h1>Home Loan (Bond) Sliding Calculator</h1>
          <span class="badge">Demo — single file</span>
        </header>

        <div class="calc-layout">
          <!-- LEFT: Inputs -->
          <section class="panel" aria-labelledby="inputs-title">
            <h2 id="inputs-title">Inputs</h2>
            <div class="inputs">
              <!-- Property price -->
              <div class="field">
                <div>
                  <label class="field-label" for="priceRange">Property price</label>
                  <input id="priceRange" type="range" min="200000" max="10000000" step="50000" value="1500000" />
                </div>
                <input id="priceNumber" class="number" type="number" min="200000" max="10000000" step="50000" value="1500000" inputmode="numeric" aria-label="Property price number"/>
              </div>

              <!-- Deposit percent -->
              <div class="field">
                <div>
                  <label class="field-label" for="depositRange">Deposit percent</label>
                  <input id="depositRange" type="range" min="0" max="50" step="1" value="10" />
                </div>
                <input id="depositNumber" class="number" type="number" min="0" max="50" step="1" value="10" aria-label="Deposit percent number"/>
              </div>

              <!-- Interest rate -->
              <div class="field">
                <div>
                  <label class="field-label" for="rateRange">Interest rate (annual, %)</label>
                  <input id="rateRange" type="range" min="5" max="20" step="0.25" value="11.75" />
                </div>
                <input id="rateNumber" class="number" type="number" min="5" max="20" step="0.25" value="11.75" aria-label="Interest rate percent number"/>
              </div>

              <!-- Term years -->
              <div class="field">
                <div>
                  <label class="field-label" for="termRange">Term (years)</label>
                  <input id="termRange" type="range" min="5" max="30" step="1" value="20" />
                </div>
                <input id="termNumber" class="number" type="number" min="5" max="30" step="1" value="20" aria-label="Term years number"/>
              </div>

              <div class="controls">
                <button id="resetBtn" class="btn" type="button">Reset</button>
                <button id="exampleBtn" class="btn primary" type="button">Try an example</button>
              </div>
            </div>
          </section>

          <!-- RIGHT: Results -->
          <section class="panel results" aria-labelledby="results-title">
            <h2 id="results-title">Results</h2>
            <div class="results-grid">
              <div class="result-card featured" aria-live="polite">
                <h3>Monthly repayment</h3>
                <div id="monthly" class="big">R 0</div>
                <div class="foot" id="headlineDetail">Based on the inputs at left.</div>
              </div>

              <div class="result-card">
                <h3>Total interest</h3>
                <div id="totalInterest" class="big">R 0</div>
              </div>

              <div class="result-card">
                <h3>Total repaid (principal + interest)</h3>
                <div id="totalRepaid" class="big">R 0</div>
              </div>

              <div class="result-card chart-card">
                <h3>Payment breakdown</h3>
                <canvas id="piChart" height="180"></canvas>
              </div>
            </div>

            <p class="muted">This demo assumes a fixed rate and monthly compounding. It’s for illustration only and not financial advice.</p>
          </section>
        </div>

        <p class="muted">Built for quick visualisation. © <span id="year"></span></p>
      </div>
    </main>

    <footer class="site-footer" role="contentinfo">
      <div class="footer-inner">
        <p class="footer-copy">
          &copy; <span id="copyright-year"></span> Starter Landing Page. All rights reserved.
        </p>
        <nav class="footer-nav" aria-label="Footer navigation">
          <ul class="footer-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#features">Features</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="#top">Back to top</a></li>
          </ul>
        </nav>
      </div>
    </footer>

    <button type="button" class="back-to-top" aria-label="Back to top">
      <span class="back-to-top__icon" aria-hidden="true">↑</span>
      <span class="back-to-top__label" aria-hidden="true">Top</span>
    </button>

    <script>
(function(){
  // Shorthand helpers
  const $ = (id) => document.getElementById(id);
  const fmtZAR = (n) => n.toLocaleString('en-ZA', { style:'currency', currency:'ZAR', maximumFractionDigits:0 });
  const fmtPct = (n) => `${Number(n).toFixed(2).replace(/\.00$/, '')}%`;

  // Link slider + number pairs bi‑directionally, and update the progress fill via CSS var --_pct
  function bindPair(range, number, onChange){
    const min = Number(range.min);
    const max = Number(range.max);
    const stepAttr = range.step && range.step !== 'any' ? range.step : (number.step && number.step !== 'any' ? number.step : '1');
    const step = Number(stepAttr);
    const stepDigits = (() => {
      if (!stepAttr) return 0;
      if (stepAttr.includes('e-')) {
        const exp = Number(stepAttr.split('e-')[1]);
        return Number.isFinite(exp) ? exp : 0;
      }
      const dot = stepAttr.indexOf('.');
      return dot === -1 ? 0 : (stepAttr.length - dot - 1);
    })();
    const effectiveStep = Number.isFinite(step) && step > 0 ? step : 1;

    const formatValue = (val) => {
      if (stepDigits <= 0) return String(Math.round(val));
      return val.toFixed(stepDigits).replace(/\.0+$/, '').replace(/(\.\d*?)0+$/, '$1');
    };

    const clampToStep = (raw) => {
      let val = Number(raw);
      if (!Number.isFinite(val)) {
        val = Number(range.value);
      }
      val = Math.min(Math.max(val, min), max);
      const steps = Math.round((val - min) / effectiveStep);
      val = min + steps * effectiveStep;
      val = Number(val.toFixed(stepDigits));
      if (val < min) val = min;
      if (val > max) val = max;
      return val;
    };

    const update = (val) => {
      const pctDenom = max - min;
      const pct = pctDenom === 0 ? 0 : ((val - min) / pctDenom) * 100;
      range.value = String(val);
      number.value = formatValue(val);
      range.style.setProperty('--_pct', pct + '%');
      range.setAttribute('aria-valuenow', String(val));
      onChange(val);
    };

    const handleRangeInput = () => {
      const val = clampToStep(range.value);
      update(val);
    };

    const handleNumberInput = (force) => {
      const raw = number.value.trim();
      if (raw === '') {
        if (force) {
          number.value = formatValue(clampToStep(range.value));
        }
        return;
      }
      const parsed = Number(raw);
      if (!Number.isFinite(parsed)) {
        if (force) {
          number.value = formatValue(clampToStep(range.value));
        }
        return;
      }
      const val = clampToStep(parsed);
      if (!force && Math.abs(val - parsed) > Number.EPSILON * 10) {
        return;
      }
      update(val);
    };

    range.addEventListener('input', handleRangeInput);
    number.addEventListener('input', () => handleNumberInput(false));
    number.addEventListener('change', () => handleNumberInput(true));
    number.addEventListener('blur', () => handleNumberInput(true));

    update(clampToStep(range.value));
  }

  // Inputs
  const priceRange = $('priceRange'), priceNumber = $('priceNumber');
  const depositRange = $('depositRange'), depositNumber = $('depositNumber');
  const rateRange = $('rateRange'), rateNumber = $('rateNumber');
  const termRange = $('termRange'), termNumber = $('termNumber');

  // Outputs
  const monthlyEl = $('monthly');
  const totalInterestEl = $('totalInterest');
  const totalRepaidEl = $('totalRepaid');
  const headlineDetail = $('headlineDetail');

  // Chart
  let chart;
  function ensureChart(){
    if(chart) return chart;
    const ctx = $('piChart');
    chart = new Chart(ctx, {
      type: 'doughnut',
      data: { labels: ['Principal','Interest'], datasets:[{ data:[1,1], borderWidth:0, hoverOffset:4, backgroundColor:['#60a5fa','#cbd5e1'] }] },
      options: { plugins:{ legend:{ position:'bottom' } }, cutout:'62%' }
    });
    return chart;
  }

  // Core calculation (annuity formula)
  function calc(){
    const price = Number(priceRange.value);
    const depositPct = Number(depositRange.value) / 100;
    const rateAnnual = Number(rateRange.value) / 100; // e.g., 0.1175 for 11.75%
    const years = Number(termRange.value);

    const principal = Math.max(0, price * (1 - depositPct));
    const r = rateAnnual / 12;            // monthly rate
    const n = years * 12;                 // number of payments

    let monthly;
    if (r === 0) {
      monthly = principal / n;
    } else {
      const pow = Math.pow(1 + r, n);
      monthly = principal * r * pow / (pow - 1);
    }

    const totalRepaid = monthly * n;
    const totalInterest = totalRepaid - principal;

    // Write to UI
    priceRange.setAttribute('aria-valuetext', fmtZAR(price));
    depositRange.setAttribute('aria-valuetext', `${Math.round(depositPct*100)} percent`);
    rateRange.setAttribute('aria-valuetext', fmtPct(rateAnnual*100).replace('%', ' percent'));
    termRange.setAttribute('aria-valuetext', `${years} years`);

    monthlyEl.textContent = fmtZAR(monthly);
    totalRepaidEl.textContent = fmtZAR(totalRepaid);
    totalInterestEl.textContent = fmtZAR(totalInterest);
    headlineDetail.textContent = `Price ${fmtZAR(price)} • Deposit ${Math.round(depositPct*100)}% • Rate ${fmtPct(rateAnnual*100)} • Term ${years} years`;

    // Chart
    const c = ensureChart();
    c.data.datasets[0].data = [principal, totalInterest];
    c.update();
  }

  // Bind pairs and compute
  bindPair(priceRange, priceNumber, () => calc());
  bindPair(depositRange, depositNumber, () => calc());
  bindPair(rateRange, rateNumber, () => calc());
  bindPair(termRange, termNumber, () => calc());

  // Buttons
  $('resetBtn').addEventListener('click', () => {
    priceRange.value = priceNumber.value = 1500000;
    depositRange.value = depositNumber.value = 10;
    rateRange.value = rateNumber.value = 11.75;
    termRange.value = termNumber.value = 20;
    // repaint fills
    [priceRange, depositRange, rateRange, termRange].forEach(r => r.dispatchEvent(new Event('input')));
    calc();
  });

  $('exampleBtn').addEventListener('click', () => {
    priceRange.value = priceNumber.value = 3500000;
    depositRange.value = depositNumber.value = 12;
    rateRange.value = rateNumber.value = 10.5;
    termRange.value = termNumber.value = 25;
    [priceRange, depositRange, rateRange, termRange].forEach(r => r.dispatchEvent(new Event('input')));
    calc();
  });

  // First render
  document.getElementById('year').textContent = new Date().getFullYear();
  calc();
})();
    </script>
  </body>
</html>
